
<script>
    window.Plutonium = window.Plutonium || {};

    /**
     * Application routing behavior implementation.
     *
     * @polymerBehavior
     */
    Plutonium.ApplicationRoutingBehaviorImpl = {
        properties: {
            _signedIn: {
                type: Boolean,
                value: false,
                notify: true
            },
            _resourceHeaders: {
                type: Object,
                computed: '_computeResourceHeaders(_authenticationHeaders)'
            },
            page: {
                type: String,
                reflectToAttribute: true,
                observer: '_pageChanged'
            }
        },
        observers: [
            '_routePageChanged(routeData.page, _signedIn)'
        ],
        _routePageChanged: function (page, _signedIn) {
            if (_signedIn) {
                this.page = page || 'view1';
            } else {
                this.page = 'login';
            }
        },
        _pageChanged: function (page) {
            // Load page import on demand. Show 404 page if fails
            var resolvedPageUrl = this.resolveUrl('my-' + page + '.html');
            this.importHref(resolvedPageUrl, null, this._showPage404, true);
        },
        _showPage404: function () {
            this.page = 'view404';
        },
        _computeResourceHeaders: function (authenticationHeaders) {
            var headers = authenticationHeaders || {};
            headers['X-Requested-With'] = 'XMLHttpRequest';
            headers['X-Requested-By'] = document.location.hostname;
            return headers;
        },
        _onUserAjaxResponse: function (event, response) {
            console.debug(this.is, 'user session fetched.');
            this.set('route.path', '/');
        },
        _onUserAjaxError: function (event, error) {
            console.warn(this.is, 'user session fetching failed.');
            this.set('route.path', '/login');
        },
    };

    /**
     * Application routing behavior.
     *
     * @polymerBehavior
     */
    Plutonium.ApplicationRoutingBehavior = [
        Plutonium.ApplicationRoutingBehaviorImpl
    ];
</script>
